package example.rdd

import org.apache.spark.sql.{Row, SQLContext}
import org.apache.spark.{SparkConf, SparkContext}

import example.common.Data

object RDDExample {

    def main(arg: Array[String]): Unit = {

        val conf = new SparkConf()
          .setAppName("Example")
          .setMaster("local[*]")

        val sc = new SparkContext(conf)

        val sqlContext = new SQLContext(sc)

        // load initial RDD
        val rdd = sc.parallelize(Data.sampleData())

        // example tranformation
        rdd.filter(p => p.state == "CO")

//        // convert to RDD[Row]
//        val rowRdd = rdd.map(person => Row(person.getAge, person))
//
//        // convert to DataFrame (RDD + Schema)
//        val dataFrame = sqlContext.createDataFrame(rowRdd, schema)
//
//        // register as a table
//        dataFrame.registerTempTable("person")
//
//        // selecting the whole object works fine
//        println("Example 1: Select whole object");
//        val results = sqlContext.sql("SELECT person FROM person")
//        val people = results.collect
//        people.map(row => println(row))
//
//        // using functions to extract values works, but does not seem ideal
//        println("Example 2: Select attribute from object using UDF");
//        sqlContext.udf.register("getFirstName", (p: MockPerson) => p.getFirstName)
//        val results2 = sqlContext.sql("SELECT getFirstName(person) FROM person")
//        val people2 = results2.collect
//        people2.map(row => println(row))
//
//        // what I really want to do, is this... but it fails with "Can't extract value from person#1"
//        println("Example 3: Select attribute from object natively");
//        val results3 = sqlContext.sql("SELECT person.firstName FROM person")
//        val people3 = results3.collect
//        people3.map(row => println(row))

      }

    }








